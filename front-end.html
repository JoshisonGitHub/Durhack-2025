<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>AR Trigger Button</title>
  <style>
    :root { --safe-bottom: env(safe-area-inset-bottom, 0px); }
    html, body {
      height: 100%; margin: 0; background:#0f1115; color:#eaeef7;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
    }
    .wrap {
      min-height: 100%;
      display: flex; flex-direction: column; align-items: stretch;
    }
    .content {
      flex: 1 1 auto;
      display: grid; place-items: center;
      padding: 24px;
      text-align: center;
    }
    .title { font-size: 24px; opacity: .9; }
    .subtitle { font-size: 14px; opacity: .6; margin-top: 8px; }
    .bar {
      position: sticky; bottom: 0; left: 0; right: 0;
      padding: 12px 16px calc(12px + var(--safe-bottom));
      backdrop-filter: blur(10px);
      background: rgba(15,17,21,.7);
      border-top: 1px solid rgba(255,255,255,.08);
    }
    .btn {
      appearance: none; width: 100%;
      font-size: 22px; font-weight: 700; letter-spacing: .3px;
      padding: 18px 22px; border-radius: 16px; border: none;
      background: #4f7cff; color: white;
      box-shadow: 0 8px 24px rgba(79,124,255,.35), inset 0 -2px 0 rgba(0,0,0,.15);
      touch-action: manipulation;
    }
    .btn:active { transform: translateY(1px); filter: brightness(.98); }
    .btn[disabled] { opacity: .6; filter: grayscale(.2); box-shadow: none; }
    .toast {
      position: fixed; left: 50%; bottom: calc(86px + var(--safe-bottom));
      transform: translateX(-50%);
      background: #1b2130; color: #eaeef7;
      padding: 10px 14px; border-radius: 12px;
      font-size: 14px; opacity: 0; pointer-events: none;
      transition: opacity .2s ease;
      border: 1px solid rgba(255,255,255,.08);
    }
    .toast.show { opacity: 1; }
    .ip {
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
      padding: 2px 6px; border-radius: 6px; background: rgba(255,255,255,.06);
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="content">
      <div>
        <div class="title">AR Game Trigger</div>
        <div class="subtitle">
          Tap the button below to send a signal to
          <span class="ip" id="ip">http://YOUR_LAPTOP_IP_HERE:5000/press</span>
        </div>
      </div>
    </div>

    <div class="bar">
      <button id="bigBtn" class="btn">PRESS</button>
    </div>
  </div>

  <div id="toast" class="toast">Sent âœ…</div>

  <script>
    // ðŸ‘‰ Set your laptop server URL here:
    const SERVER_URL = "http://YOUR_LAPTOP_IP_HERE:5000/press";

    const btn = document.getElementById('bigBtn');
    const toast = document.getElementById('toast');
    const ipSpan = document.getElementById('ip');
    ipSpan.textContent = SERVER_URL;

    let busy = false;

    function showToast(text) {
      toast.textContent = text;
      toast.classList.add('show');
      clearTimeout(showToast._t);
      showToast._t = setTimeout(() => toast.classList.remove('show'), 1200);
    }

    function haptics() {
      if (navigator.vibrate) navigator.vibrate(10);
      // iOS haptics via CSS active state is limited; this is fine for most devices.
    }

    async function sendPress() {
      if (busy) return;
      busy = true; btn.disabled = true; haptics();

      // Prefer POST with fetch (requires CORS allowed on server).
      try {
        const res = await fetch(SERVER_URL, {
          method: 'POST',
          mode: 'cors', // change to 'no-cors' to suppress CORS errors (but no status)
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ t: Date.now(), source: 'phone' }),
          keepalive: true
        });

        if (!res.ok) throw new Error('HTTP ' + res.status);
        showToast('Sent âœ…');
      } catch (err) {
        // Fallback that ignores CORS by using an Image GET beacon to /press
        try {
          await new Promise((resolve, reject) => {
            const img = new Image();
            const url = SERVER_URL + (SERVER_URL.includes('?') ? '&' : '?') + 't=' + Date.now();
            img.onload = resolve; img.onerror = resolve; // resolve either way (fire-and-forget)
            img.src = url;
            setTimeout(resolve, 400); // resolve if no callback fires (some servers return JSON)
          });
          showToast('Sent (fallback) âœ…');
        } catch {
          showToast('Failed âŒ');
        }
      } finally {
        setTimeout(() => { busy = false; btn.disabled = false; }, 250);
      }
    }

    btn.addEventListener('click', sendPress);

    // Prevent double-tap to zoom on iOS
    let lastTouch = 0;
    document.addEventListener('touchend', e => {
      const now = Date.now();
      if (now - lastTouch <= 300) e.preventDefault();
      lastTouch = now;
    }, { passive: false });
  </script>
</body>
</html>
